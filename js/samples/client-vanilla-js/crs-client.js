!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("axios")):"function"==typeof define&&define.amd?define(["axios"],t):"object"==typeof exports?exports.crsClient=t(require("axios")):e.crsClient=t(e.axios)}(window,function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataPath="__meta",t.defaultMetadataOptions={showAmbientValues:!0,showCommands:!0}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._values=e}return Object.defineProperty(e.prototype,"values",{get:function(){return this._values},enumerable:!0,configurable:!0}),e.prototype.setValues=function(e){this._values=e},e.prototype.merge=function(e){return r({},e,this.values)},e}();t.AmbientValuesProvider=o},function(e,t,n){"use strict";function r(e){var n=e.constructor[t.CommandMetadataSym];if(!n)throw new Error("Could not read the command metadata. The decorator is probably missing.");return n}Object.defineProperty(t,"__esModule",{value:!0}),t.CommandMetadataSym=Symbol("CrsCommandMetadata"),t.Command=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(r){return r[t.CommandMetadataSym]={name:e,events:n},r}},t.readMetadata=r,t.readCommandName=function(e){return r(e).name}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(4);var a=function(){function e(e,t,n,r,o){this.crsEndpoint=e,this.axiosInstance=t,this.metadataService=n,this.ambientValuesProvider=r,this.responseReceivers=o}return e.prototype.findCallerId=function(){for(var e=void 0,t=0;t<this.responseReceivers.length;t++){var n=this.responseReceivers[t];if(void 0!==n.getCallerId&&(e=n.getCallerId()),e)break}return e||(new Date).getTime().toString()},e.prototype.sendCommand=function(e){var t=this,n=r.readCommandName(e),a=this.ambientValuesProvider.merge(e);return console.debug("CRS: Sending command - CommandName: "+n),this.postCommand(n,a).then(function(e){for(var r=Promise.resolve(e),a=function(e){var n=t.responseReceivers[e];r=r.then(function(e){return n.processCommandResponse(e)})},i=0;i<t.responseReceivers.length;i++)a(i);return r.then(function(e){switch(e.responseType){case o.ResponseType.Synchronous:case o.ResponseType.Meta:return console.debug("CRS: Received command response - CommandName: "+n+"; CommandId: "+e.commandId),e.payload;case o.ResponseType.Asynchronous:throw new Error("CRS: Received a deferred command response, but no ResponseReceiver handled it. Add an async response receiver (eg. signalr). CommandName: "+n+"; CommandId: "+e.commandId);case o.ResponseType.ValidationError:throw console.error(e.payload),new Error("CRS: Received validation error. CommandName: "+n+"; CommandId: "+e.commandId);case o.ResponseType.InternalErrorResponseType:throw console.error(e.payload),new Error("CRS: Received internal error. CommandName: "+n+"; CommandId: "+e.commandId);default:throw new Error("CRS: Unknown ResponseType "+e.responseType+". CommandName: "+n+"; CommandId: "+e.commandId)}})})},e.prototype.postCommand=function(e,t){var n=this,r=this.crsEndpoint+"/"+e,o=this.findCallerId();if(this.metadataService.currentMetadataPromise)return this.metadataService.currentMetadataPromise.then(function(e){var a,i=((a={})[e.callerIdPropertyName]=o,a);return n.axiosInstance.post(r+"?"+function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(i),t).then(function(e){return e.data})});throw new Error("CRS has not been initialized.")},e}();t.CommandEmitter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ValidationError="V",e.InternalErrorResponseType="I",e.Synchronous="S",e.Asynchronous="A",e.Meta="M"}(t.ResponseType||(t.ResponseType={}))},function(t,n){t.exports=e},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(5)),a=n(0),i=function(){function e(e,t,n,r){this.crsEndpoint=e,this.axios=t,this.options=n,this.ambientValuesProvider=r}return e.prototype.reloadMetadata=function(){var e=this;return void 0!==this.cts&&this.cts.cancel(),this.cts=o.default.CancelToken.source(),this.currentMetadataPromise=this.fetchMetadata(this.cts.token).then(function(t){if(void 0===t.payload)throw new Error("CRS: Metadata response didn't have a payload property");return e.ambientValuesProvider.setValues(t.payload.ambientValues),console.debug("CRS: Loaded metadata"),t.payload}),this.currentMetadataPromise},e.prototype.fetchMetadata=function(e){var t=this.crsEndpoint+"/"+a.MetadataPath;return console.debug("CRS: Fetching medatata from "+t),this.axios.post(t,this.options,{cancelToken:e}).then(function(e){return e.data})},e}();t.MetadataService=i},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(1)),r(n(2)),r(n(3)),r(n(8)),r(n(0)),r(n(6)),r(n(4))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(5)),i=n(6),s=n(3),d=n(1),c=n(0),u=function(){function e(e){if(this.config=r({},e),!this.config.url)throw new Error("CrsEndpoint configuration does not have a valid url property");void 0===this.config.axiosInstance&&(this.config.axiosInstance=a.default),void 0===this.config.responseReceivers&&(this.config.responseReceivers=[]),void 0===this.config.metadataOptions&&(this.config.metadataOptions=c.defaultMetadataOptions),this.responseReceivers=this.config.responseReceivers,this.ambientValuesProvider=new d.AmbientValuesProvider,this.metadataService=new i.MetadataService(this.config.url,this.config.axiosInstance,this.config.metadataOptions,this.ambientValuesProvider),this.commandEmitter=new s.CommandEmitter(this.config.url,this.config.axiosInstance,this.metadataService,this.ambientValuesProvider,this.responseReceivers)}return e.prototype.send=function(e){return this.commandEmitter.sendCommand(e)},e.prototype.reloadMetadata=function(){return this.internalReloadMetadata()},e.prototype.getMetadata=function(){if(this.metadataService.currentMetadataPromise)return this.metadataService.currentMetadataPromise;throw new Error("CRS has not been initialized.")},e.prototype.initialize=function(){console.debug("CRS: Initializing");for(var e=this.internalReloadMetadata(),t=[e],n=0;n<this.responseReceivers.length;n++){var r=this.responseReceivers[n];r.initialize&&t.push(r.initialize())}return Promise.all(t).then(function(t){return console.debug("CRS: Ready"),e})},e.prototype.internalReloadMetadata=function(){return this.metadataService.reloadMetadata()},e}();t.CrsEndpoint=u}])});
//# sourceMappingURL=crs-client.js.map